<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhisperNet - Home</title>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #f8f5ff 0%, #f0e6ff 50%, #f8f5ff 100%);
      background-attachment: fixed;
      background-size: cover;
      background-repeat: no-repeat;
      min-height: 100%;
      color: #333;
    }

    html {
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    .app-container {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      min-height: 100%;
      gap: 24px;
    }

    /* Sidebar Navigation */
    .sidebar {
      width: 260px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-right: none;
      padding: 20px;
      position: sticky;
      top: 0;
      height: 100%;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 40px;
      padding: 16px;
      border-radius: 16px;
      background: linear-gradient(135deg, #f5f0ff 0%, #e8d5f2 100%);
    }

    .logo {
      font-size: 32px;
    }

    .site-title {
      font-size: 20px;
      font-weight: 700;
      color: #8b458b;
      margin: 0;
      background: linear-gradient(135deg, #8b458b 0%, #b19cd9 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .nav-item {
      margin-bottom: 8px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 20px;
      border-radius: 16px;
      text-decoration: none;
      color: #666;
      font-weight: 600;
      font-size: 18px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .nav-link:hover {
      background: linear-gradient(135deg, #f5f0ff 0%, #e8d5f2 100%);
      color: #8b458b;
      transform: translateX(4px);
    }

    .nav-link.active {
      background: linear-gradient(135deg, #b19cd9 0%, #d4c5f9 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(177, 156, 217, 0.3);
    }

    .nav-icon {
      font-size: 24px;
      width: 24px;
      text-align: center;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      max-width: 600px;
      border-right: 1px solid #e8d5f2;
      background: rgba(255, 255, 255, 0.8);
    }

    .header {
      padding: 20px 24px;
      border-bottom: 1px solid #e8d5f2;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
      color: #8b458b;
    }

    /* Compose Section */
    .compose-section {
      padding: 16px 20px;
      border-bottom: 1px solid #e8d5f2;
    }

    .compose-box {
      display: flex;
      gap: 12px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #b19cd9 0%, #d4c5f9 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: white;
      flex-shrink: 0;
    }

    .compose-form {
      flex: 1;
    }

    .compose-textarea {
      width: 100%;
      border: none;
      outline: none;
      font-size: 18px;
      font-family: inherit;
      resize: none;
      background: transparent;
      color: #333;
      min-height: 80px;
      padding: 12px 0;
    }

    .compose-textarea::placeholder {
      color: #9d7bb3;
    }

    .compose-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-top: 8px;
    }

    .compose-tools {
      display: flex;
      gap: 16px;
    }

    .tool-button {
      background: none;
      border: none;
      font-size: 20px;
      color: #9d7bb3;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .tool-button:hover {
      background: #f5f0ff;
      color: #8b458b;
    }

    .post-button {
      background: linear-gradient(135deg, #b19cd9 0%, #d4c5f9 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .post-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(177, 156, 217, 0.4);
    }

    .post-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Feed */
    .feed {
      padding: 0;
    }

    .empty-state {
      text-align: center;
      padding: 80px 40px;
      color: #9d7bb3;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 24px;
      opacity: 0.6;
    }

    .empty-title {
      font-size: 24px;
      font-weight: 600;
      color: #8b458b;
      margin: 0 0 12px 0;
    }

    .empty-message {
      font-size: 16px;
      margin: 0;
      opacity: 0.8;
    }

    .post {
      padding: 20px 24px;
      border-bottom: 1px solid #e8d5f2;
      transition: background-color 0.3s ease;
      cursor: pointer;
    }

    .post:hover {
      background: rgba(245, 240, 255, 0.5);
    }

    .post-header {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }

    .post-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #d4c5f9 0%, #e8d5f2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: #8b458b;
      flex-shrink: 0;
    }

    .post-info {
      flex: 1;
    }

    .post-username {
      font-weight: 600;
      color: #8b458b;
      margin-right: 8px;
    }

    .post-handle {
      color: #9d7bb3;
      margin-right: 8px;
    }

    .post-time {
      color: #9d7bb3;
      font-size: 14px;
    }

    .post-content {
      margin: 12px 0;
      font-size: 16px;
      line-height: 1.5;
      color: #333;
    }

    .post-actions {
      display: flex;
      justify-content: space-between;
      max-width: 400px;
      margin-top: 16px;
    }

    .action-button {
      display: flex;
      align-items: center;
      gap: 8px;
      background: none;
      border: none;
      color: #9d7bb3;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 12px;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .action-button:hover {
      background: #f5f0ff;
      color: #8b458b;
    }

    .action-button.liked {
      color: #e74c3c;
    }

    /* Right Sidebar */
    .right-sidebar {
      width: 320px;
      padding: 20px;
    }

    .trending-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #e8d5f2;
    }

    .trending-title {
      font-size: 20px;
      font-weight: 700;
      color: #8b458b;
      margin: 0 0 16px 0;
    }

    .trending-item {
      padding: 12px 0;
      border-bottom: 1px solid #f5f0ff;
    }

    .trending-item:last-child {
      border-bottom: none;
    }

    .trending-topic {
      font-weight: 600;
      color: #8b458b;
      margin-bottom: 4px;
    }

    .trending-posts {
      font-size: 14px;
      color: #9d7bb3;
    }

    .trending-rank {
      color: #8b458b;
      font-weight: 700;
      margin-right: 8px;
    }

    .trending-empty {
      text-align: center;
      padding: 20px;
      color: #9d7bb3;
      font-style: italic;
    }

    .trending-empty p {
      margin: 0;
      font-size: 14px;
    }

    @media (max-width: 1024px) {
      .right-sidebar {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 80px;
        padding: 20px 10px;
      }

      .nav-text {
        display: none;
      }

      .logo-section {
        justify-content: center;
      }

      .site-title {
        display: none;
      }

      .main-content {
        max-width: none;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container"><nav class="sidebar">
    <div class="logo-section">
     <div class="logo">
      üí≠
     </div>
     <h1 id="site-title" class="site-title">WhisperNet</h1>
    </div>
    <ul class="nav-menu">
     <li class="nav-item"><a href="#" class="nav-link active" data-section="feed"> <span class="nav-icon">üè†</span> <span id="feed-label" class="nav-text">Feed</span> </a></li>
     <li class="nav-item"><a href="#" class="nav-link" data-section="search"> <span class="nav-icon">üîç</span> <span id="search-label" class="nav-text">Search</span> </a></li>
     <li class="nav-item"><a href="#" class="nav-link" data-section="ranking"> <span class="nav-icon">üìä</span> <span id="ranking-label" class="nav-text">Ranking</span> </a></li>
     <li class="nav-item"><a href="#" class="nav-link" data-section="profile"> <span class="nav-icon">üë§</span> <span id="profile-label" class="nav-text">Profile</span> </a></li>
     <li class="nav-item" style="margin-top: 24px;"><a href="#" class="nav-link" id="logout-link"> <span class="nav-icon">üö™</span> <span class="nav-text">Logout</span> </a></li>
    </ul>
   </nav><main class="main-content">
    <header class="header">
     <h1>Home</h1>
    </header><section class="compose-section">
     <div class="compose-box">
      <div class="avatar">
       üë§
      </div>
      <form class="compose-form" id="compose-form"><textarea id="compose-textarea" class="compose-textarea" placeholder="What's on your mind anonymously?" maxlength="280"></textarea>
       <div class="compose-actions"><button type="submit" class="post-button" id="post-button" disabled>Post</button>
       </div>
      </form>
     </div>
    </section><section class="feed" id="feed"></section>
   </main><aside class="right-sidebar">
    <div class="trending-section">
     <h2 class="trending-title">Top Whispers</h2>
     <div id="trending-list"></div>
    </div>
   </aside>
  </div>
  <script>
    const defaultConfig = {
      background_color: '#f8f5ff',
      surface_color: '#ffffff',
      text_color: '#333333',
      primary_color: '#b19cd9',
      secondary_color: '#9d7bb3',
      font_family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',
      font_size: 16,
      site_title: 'WhisperNet',
      compose_placeholder: "What's on your mind anonymously?",
      feed_label: 'Feed',
      // *** REMOVED compose_label ***
      search_label: 'Search',
      ranking_label: 'Ranking',
      profile_label: 'Profile'
    };

    let whisperCounter = 1; // Next whisper number
    let posts = [];

    async function initApp() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif';
            const baseSize = config.font_size || defaultConfig.font_size;

            document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
            document.body.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color} 0%, #f0e6ff 50%, ${config.background_color || defaultConfig.background_color} 100%)`;

            document.getElementById('site-title').textContent = config.site_title || defaultConfig.site_title;
            document.getElementById('compose-textarea').placeholder = config.compose_placeholder || defaultConfig.compose_placeholder;
            
            document.getElementById('feed-label').textContent = config.feed_label || defaultConfig.feed_label;
            // *** REMOVED compose_label update ***
            document.getElementById('search-label').textContent = config.search_label || defaultConfig.search_label;
            document.getElementById('ranking-label').textContent = config.ranking_label || defaultConfig.ranking_label;
            document.getElementById('profile-label').textContent = config.profile_label || defaultConfig.profile_label;

            document.body.style.fontSize = `${baseSize}px`;
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => {
                  config.primary_color = value;
                  window.elementSdk.setConfig({ primary_color: value });
                }
              },
              {
                get: () => config.secondary_color || defaultConfig.secondary_color,
                set: (value) => {
                  config.secondary_color = value;
                  window.elementSdk.setConfig({ secondary_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ['site_title', config.site_title || defaultConfig.site_title],
            ['compose_placeholder', config.compose_placeholder || defaultConfig.compose_placeholder],
            ['feed_label', config.feed_label || defaultConfig.feed_label],
            // *** REMOVED compose_label ***
            ['search_label', config.search_label || defaultConfig.search_label],
            ['ranking_label', config.ranking_label || defaultConfig.ranking_label],
            ['profile_label', config.profile_label || defaultConfig.profile_label]
          ])
        });
      }

      setupEventListeners();
      renderFeed();
    }

    function setupEventListeners() {
      // Navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        if (link.id === 'logout-link') {
          // Add listener for logout
          link.addEventListener('click', (e) => {
            e.preventDefault();
            // In a real app, you'd clear session/token here
            console.log('Logging out...');
            window.location.href = 'base.html';
          });
        } else {
          // Add listener for main navigation
          link.addEventListener('click', handleNavigation);
        }
      });

      // Compose form
      const composeTextarea = document.getElementById('compose-textarea');
      const postButton = document.getElementById('post-button');
      
      composeTextarea.addEventListener('input', () => {
        postButton.disabled = composeTextarea.value.trim().length === 0;
      });

      document.getElementById('compose-form').addEventListener('submit', handlePost);
    }

    function handleNavigation(e) {
      e.preventDefault();
      
      // Update active state
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      e.currentTarget.classList.add('active');

      const section = e.currentTarget.dataset.section;
      
      // Simple navigation feedback
      const header = document.querySelector('.header h1');
      switch(section) {
        case 'feed':
          header.textContent = 'Home';
          break;
        // *** REMOVED 'compose' case ***
        case 'search':
          header.textContent = 'Search';
          break;
        case 'ranking':
          header.textContent = 'Trending';
          break;
        case 'profile':
          header.textContent = 'Profile';
          break;
      }
    }

    function handlePost(e) {
      e.preventDefault();
      
      const textarea = document.getElementById('compose-textarea');
      const content = textarea.value.trim();
      
      if (!content) return;

      const whisperNumber = whisperCounter++;
      const paddedNumber = whisperNumber.toString().padStart(4, '0');
      
      // Generate random anonymous nickname
      const nicknames = [
        'Anonymous Wanderer', 'Silent Thinker', 'Quiet Observer', 'Hidden Voice',
        'Secret Sage', 'Mysterious Mind', 'Unknown Writer', 'Faceless Friend',
        'Nameless Soul', 'Invisible Poet', 'Shadow Speaker', 'Veiled Visionary'
      ];
      const randomNickname = nicknames[Math.floor(Math.random() * nicknames.length)];
      
      const newPost = {
        id: Date.now(),
        whisperNumber: whisperNumber,
        username: `${randomNickname} | Whispering#${paddedNumber}`,
        handle: '',
        time: 'now',
        content: content,
        likes: 0,
        replies: 0,
        liked: false
      };

      posts.unshift(newPost);
      textarea.value = '';
      document.getElementById('post-button').disabled = true;
      
      renderFeed();
    }

    function renderFeed() {
      const feedContainer = document.getElementById('feed');
      feedContainer.innerHTML = '';

      if (posts.length === 0) {
        const emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        emptyState.innerHTML = `
          <div class="empty-icon">üí≠</div>
          <h3 class="empty-title">No whispers yet</h3>
          <p class="empty-message">Be the first to share an anonymous thought with the world.</p>
        `;
        feedContainer.appendChild(emptyState);
      } else {
        posts.forEach(post => {
          const postElement = createPostElement(post);
          feedContainer.appendChild(postElement);
        });
      }
      
      updateTrending();
    }

    function updateTrending() {
      const trendingContainer = document.getElementById('trending-list');
      
      if (posts.length === 0) {
        trendingContainer.innerHTML = `
          <div class="trending-empty">
            <p>No whispers to rank yet. Start the conversation!</p>
          </div>
        `;
        return;
      }
      
      // Sort posts by likes (descending) and take top 5
      const topPosts = [...posts]
        .sort((a, b) => b.likes - a.likes)
        .slice(0, 5);
      
      trendingContainer.innerHTML = '';
      
      topPosts.forEach((post, index) => {
        const paddedNumber = post.whisperNumber.toString().padStart(4, '0');
        const trendingItem = document.createElement('div');
        trendingItem.className = 'trending-item';
        trendingItem.innerHTML = `
          <div class="trending-topic">
            <span class="trending-rank">#${index + 1}</span>
            Whispering#${paddedNumber}
          </div>
          <div class="trending-posts">${post.likes} likes</div>
        `;
        trendingContainer.appendChild(trendingItem);
      });
    }

    function createPostElement(post) {
      const postDiv = document.createElement('div');
      postDiv.className = 'post';
      postDiv.innerHTML = `
        <div class="post-header">
          <div class="post-avatar">üë§</div>
          <div class="post-info">
            <span class="post-username">${post.username}</span>
            <span class="post-time">¬∑ ${post.time}</span>
          </div>
        </div>
        <div class="post-content">${post.content}</div>
        <div class="post-actions">
          <button class="action-button reply-btn" data-id="${post.id}">
            üí¨ ${post.replies}
          </button>
          <button class="action-button like-btn ${post.liked ? 'liked' : ''}" data-id="${post.id}">
            ${post.liked ? '‚ù§Ô∏è' : 'ü§ç'} ${post.likes}
          </button>
          <button class="action-button share-btn" data-id="${post.id}">
            üì§
          </button>
        </div>
      `;

      // Add event listeners for post actions
      postDiv.querySelector('.like-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        toggleLike(post.id);
      });

      return postDiv;
    }

    function toggleLike(postId) {
      const post = posts.find(p => p.id === postId);
      if (post) {
        if (post.liked) {
          post.likes--;
          post.liked = false;
        } else {
          post.likes++;
          post.liked = true;
        }
        renderFeed();
      }
    }

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99a88c39a60bba08',t:'MTc2MjQ3MzU5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.conreadyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>